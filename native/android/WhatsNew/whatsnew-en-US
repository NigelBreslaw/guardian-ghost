Bug fixes and performance tweaks.